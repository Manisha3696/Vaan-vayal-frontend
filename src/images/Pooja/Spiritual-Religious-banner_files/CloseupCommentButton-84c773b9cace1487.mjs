"use strict";(self.modernJsonp=self.modernJsonp||[]).push([[78602],{363656:(e,t,n)=>{n.r(t),n.d(t,{default:()=>l});let o={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"CloseupCommentButton_pin",selections:[{alias:null,args:null,kind:"ScalarField",name:"isEligibleForPdp",storageKey:null},{args:null,kind:"FragmentSpread",name:"CommentsPopover_pin"}],type:"Pin",abstractKey:null};o.hash="069f535669d5c7a5922989e3b70f35f7";let l=o},466107:(e,t,n)=>{n.r(t),n.d(t,{default:()=>C});var o,l=n(667294);n(422578);var i=n(20256),s=n(475110),r=n(19963),a=n(78039),c=n(41086),d=n(233846),m=n(112800),u=n(460632),p=n(12624),h=n(757653),g=n(785893);let f=(0,h.Z)(()=>n.e(12167).then(n.bind(n,752809)),void 0,e=>752809,"CommentsPopover",e=>[12167]),v=(void 0!==o||(o=n(363656)).hash&&"069f535669d5c7a5922989e3b70f35f7"!==o.hash&&console.error("The definition of 'CloseupCommentButton_pin' appears to have changed. Run `relay-compiler` to update the generated files to receive the expected data."),o);function C({inCommentsImprovedDropdownExp:e,inCommentsPopoverExp:t,isEligibleForAggregatedComments:n,pinKey:o,shouldShowCommentCount:h,totalCommentCount:C,viewParameter:_,viewType:w,scrollContainerRef:b}){let x=(0,d.ZP)(),P=(0,p.t)(),y=(0,a.Z)(v,o),T=(0,s.Z)({showProductDetailPage:!!y.isEligibleForPdp}),{isCommentThreadExpanded:E,setIsCommentThreadExpanded:I,setIsCommentComposerFocused:B}=(0,u.x4)(),{logContextEvent:R}=(0,r.u)(),j=(0,l.useRef)(null),[k,F]=(0,l.useState)(!1),L=t&&E;(0,l.useEffect)(()=>{if(!T||!b)return;let e=document.getElementById("canonical-card");if(!e)return;let t=new IntersectionObserver(e=>{let t=e[0];t&&F(t.isIntersecting)},{root:b,threshold:0});return t.observe(e),setTimeout(()=>{let n=t.takeRecords();if(n.length>0&&n[0])F(n[0].isIntersecting);else{let t=b.getBoundingClientRect(),n=e.getBoundingClientRect();F(n.top>=t.top&&n.top<=t.bottom)}},100),()=>{t.disconnect()}},[T,b]);let Z=x._('Comments', 'Closeup.Comment.Icon', 'Icon for scrolling comments into view'),z=t=>{R({component:13464,element:2,event_type:10554,view_parameter:_,view_type:w}),(0,m.tj)("dweb.closeup_comment_button.community_view_intent",{tags:{experimentGroup:e?"improved_dropdown":"popover",clickSource:t}})},D=n=>{if(t)E?I?.(!1):(I?.(!0),z(n));else if(T){let e=C>0;E||!e||I?.(!0),z(n),B(!0)}else(t=>{let n=document.getElementById("canonical-card"),o=document.querySelector('[data-test-id="canonical-card-tap-area"]');if(!n)return;if(T&&b){let l=b.getBoundingClientRect(),i=n.getBoundingClientRect().top-l.top,s=b.scrollTop+i-P,r=null,a=()=>{r&&clearTimeout(r),r=setTimeout(()=>{e&&(I?.(!0),z(t)),o&&o.focus(),b.removeEventListener("scroll",a)},100)};b.addEventListener("scroll",a,{passive:!0}),a(),b.scrollTo({top:s,behavior:"smooth"});return}let l=n.getBoundingClientRect().top+window.scrollY-P,i=null,s=()=>{i&&clearTimeout(i),i=setTimeout(()=>{e&&(I?.(!0),z(t)),o&&o.focus(),window.removeEventListener("scroll",s)},100)};window.addEventListener("scroll",s,{passive:!0}),s(),window.scrollTo({top:l,behavior:"smooth"})})(n)};return(0,g.jsxs)(i.xu,{children:[L&&(0,g.jsx)(f,{anchorRef:j,pinKey:y,setIsOpen:I,viewParameter:_}),(0,g.jsxs)(i.kC,{alignItems:"center",direction:"row",children:[(0,g.jsx)(i.hU,{ref:j,accessibilityLabel:Z,disabled:!n,icon:"speech-outline",onClick:()=>D("icon"),selected:L,size:"lg",tooltip:{text:Z}}),h&&(0,g.jsx)(i.iP,{disabled:!n||T&&k,onTap:()=>D("count"),children:(0,g.jsx)(i.xv,{weight:"bold",children:(0,g.jsx)(c.Z,{shortform:!0,shortformMaximumFractionDigits:1,value:C})})})]})]})}}}]);
//# sourceMappingURL=https://sm.pinimg.com/webapp/CloseupCommentButton-84c773b9cace1487.mjs.map